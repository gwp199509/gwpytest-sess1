 1，备份服务 rsyncd服务，不同主机之间数据传输，多种模式，增量传输
	全量：全部数据传输一遍  scp  scp -r /etc/ root@192.168.123.210:/tmp/
	增量：只传输修改新建的数据 rsync rsync -avz /etc/sysconfig/ root@192.168.123.210:/tmp/
	rsync服务+定时任务   定时备份
	rsync服务+sersync/lsyncd    实时同步
	推送 本地-> 远端
	拉取 远端-> 本地
	远程模式：1对1
	  rsync  -avz 源文件    目标  -z传输数据时进行压缩(公网)
		-a 代表-rlpmgoD  递归复制、复制软链接、保持权限不变、保持修改时间不变、用户组不变、所有者不变、devices设备
		--bwlimit=500kb  限速，不要与-z一起使用
		--delete 保持源和目标数据一致
	rsync守护进程模式
	  yum -y install rsync
		/etc/rsyncd.conf 配置文件
		/usr/bin/rsync  命令
		/usr/lib/systemd/system/rsyncd.service systemctl对应的配置文件
	  配置  服务端200
	    /etc/rsync.conf
			fake super = yes
			uid = rsync
			gid = rsync
			use chroot = no
			max connections = 2000
			timeout = 600
			pid file = /var/run/rsyncd.pid
			lock file = /var/run/rsync.lock

			log file = /var/log/rsyncd.log
			ignore errors
			read onlt = false
			list = false
			hosts allow = 192.168.123.0/24
			#hosts dent = 
			auth users = rsync_backup
			secrets file = /etc/rsync.password

			[data]  模块名字
			comment = www by gwp  注释说明
			path = /data  模块对应的目录
		useradd -s /sbin/nologin -M rsync
		echo 'rsync_backup:Admin@coc1' > /etc/rsync.password
		chmod 600 /etc/rsync.password
		mkdir /data
		chown -R rsync.rsync /data/
	  启动
	    systemctl start rsyncd
		systemctl enable rsyncd
	  客户端测试 210
	    rsync -avz /etc/hostname rsync_backup@192.168.123.200::data
		免密登陆
			echo 'Admin@coc1'> /etc/rsync.client
			chmod 600 /etc/rsync.client
			rsync -avz /etc/hosts rsync_backup@192.168.123.200::data --password-file=/etc/rsync.client
2，存储服务  NFS
	RPC是远程过程调用，本质起到调度作用 rpcbind
	服务端210
	  yum -y install rpcbind.x86_64 nfs-utils.x86_64
	  systemctl enable rpcbind
	  systemctl start rpcbind    一定要先启动rpcbind，再启动nfs
	  systemctl enable nfs
	  systemctl start nfs
	  rpcinfo -p  查看信息
	  配置文件 /etc/exports
		/data1/   172.16.1.0/24(rw)
	  systemctl reload nfs
	  mkdir /data1/
	  chown -R nfsnobody.nfsnobody /data1/  安装nfs时会自动创建用户
	  本地测试210
	  showmount -e  ip或不写   看看服务端共享哪些目录
	  mount -t nfs 172.16.1.210:/data1/ /mnt/    在/mnt/下创建文件就会同步写入到/data1/
	客户端220
	  yum -y install nfs-utils
	  mount -t nfs 172.16.1.210:/data1/ /mnt/    df -h查看  操作测试
	配置文件 /etc/exports  nfs管理systemctl命令的背后是在调用exportfs命令
	  共享目录     网络(权限)     网段、ip、域名都行
	  rw  读写     ro 只读     sync同步，只要用户上传，就把数据写到磁盘上
	  async异步，用户上传的数据，nfs先临时存放到内存中，过一段时间写入到磁盘，并发高，数据可能丢失
	  同步：在网站架构中指直接访问资源
	  异步：在网站架构中指通过各种缓存达到用户优先访问缓存，缓存没有再去访问对应服务
	  cat /var/lib/nfs/etab 
	用户压缩(映射)   隐藏权限
	  root_squash  如果客户端是root用户访问，则到了nfs服务端会被压缩（默认）
	  no_all_squash 如果客户端不是root用户访问，则不进行压缩（默认）
	  all_squash 所有用户都进行压缩
	  anonuid anongid   用于指定压缩的匿名用户（默认nfsnobody用户，anonuid=65534,anongid=65534）
	优化   客户端挂载选项 mount -o noexec,nosudi,nodev -t nfs 172.16.1.200:/data1/ /mnt/
	  noexec  挂载的nfs目录中如果有命令，无法运行
	  nosuid  带有suid的命令
	  nodev   带有特殊属性的文件
3，实时同步
  nfs+实时同步工具
  sersync国产开源，内置inotify+rsync命令，一个命令+一个配置文件
    通过inotify监控目录   通过rsync吧变化文件推送到rsync服务端
  rsync客户端210 部署sersync监控/data，  rsync服务端200，存放/nfsbackup
  nfs服务端210，共享/data目录，nfs客户端220，挂载，操作会实时同步至rsync服务器端    
  tar -tf sersync2.5.4_64bit_binary_stable_final.tar.gz
  mkdir -p /app/tools/sersync/{bin,conf}
  mv GNU-Linux-x86/sersync2 /app/tools/sersync/bin/
  mv GNU-Linux-x86/confxml.xml /app/tools/sersync/conf/
  confxml.xml
  <inotify>
        <delete start="true"/>
        <createFolder start="true"/>
        <createFile start="false"/>
        <closeWrite start="true"/>
        <moveFrom start="true"/>
        <moveTo start="true"/>
        <attrib start="false"/>
        <modify start="false"/>
    </inotify>
	<sersync>
        <localpath watch="/data">       监控的目录，即nfs服务端共享目录
            <remote ip="172.16.1.200" name="nfsbackup"/>   rsync服务端的ip地址和服务端的模块名
            <!--<remote ip="192.168.8.39" name="tongbu"/>-->  注释
            <!--<remote ip="192.168.8.40" name="tongbu"/>-->  注释
        </localpath>
        <rsync>          配置命令
            <commonParams params="-az"/>
            <auth start="true" users="rsync_backup" passwordfile="/etc/rsync.client"/> 开启认证，用户，密码
            <userDefinedPort start="false" port="874"/><!-- port=874 -->
            <timeout start="false" time="100"/><!-- timeout=100 -->
            <ssh start="false"/>
        </rsync>
        <failLog path="/var/log/rsync_fail_log.log" timeToExecute="60"/><!--default every 60mins execute once-->
	mkdir -p /data/
	/app/tools/sersync/bin/sersync2
	ln -s /app/tools/sersync/bin/sersync2 /bin/
	sersync2 -rdo /app/tools/sersync/conf/confxml.xml 
	 
	  
	  
	  
	  
	  
	  
	  


























